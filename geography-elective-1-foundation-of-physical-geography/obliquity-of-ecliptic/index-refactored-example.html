<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é»„èµ¤äº¤è§’ä¸å›å½’çº¿ - äº¤äº’å¼æ•™å­¦</title>
    
    <!-- å¼•å…¥é€šç”¨ç»„ä»¶æ ·å¼ -->
    <link rel="stylesheet" href="../../common/styles/ui-components.css">
    
    <style>
        /* é¡µé¢ç‰¹å®šæ ·å¼ */
        .info-panel .season {
            font-size: 0.9rem;
            font-weight: bold;
            color: #ffd54f;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .info-panel .subsolar-point {
            color: #81d4fa;
        }
        
        .info-panel .motion-info {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .info-panel .motion-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 3px 0;
        }
        
        .info-panel .motion-icon {
            font-size: 0.9rem;
        }
        
        .info-panel .orbit-info {
            color: #80ffaa;
        }
        
        .info-panel .rotation-info {
            color: #ffcc66;
        }

        /* è§†è§’ä¿¡æ¯é¢æ¿ */
        .view-info-panel {
            position: absolute;
            bottom: 170px;
            right: 10px;
            background: rgba(0, 0, 0, 0.75);
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            border: 1px solid rgba(100, 180, 255, 0.3);
            z-index: 50;
        }
        
        .view-info-panel h4 {
            color: #64b4ff;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }
        
        .view-info-panel .view-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 4px 0;
            color: #ccc;
        }
        
        .view-info-panel .view-icon {
            font-size: 0.85rem;
            width: 18px;
            text-align: center;
        }
        
        .view-info-panel .view-item.motion {
            color: #88ffaa;
        }
        
        .view-info-panel .view-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.15);
            margin: 8px 0;
        }

        /* å­£èŠ‚æŒ‰é’®æ ·å¼ */
        .bottom-btn-bar .season-btn.spring {
            background: linear-gradient(135deg, #66bb6a, #43a047);
        }
        .bottom-btn-bar .season-btn.summer {
            background: linear-gradient(135deg, #ff7043, #e64a19);
        }
        .bottom-btn-bar .season-btn.autumn {
            background: linear-gradient(135deg, #ffb74d, #f57c00);
        }
        .bottom-btn-bar .season-btn.winter {
            background: linear-gradient(135deg, #4fc3f7, #0288d1);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ é»„èµ¤äº¤è§’ä¸å›å½’çº¿ ğŸŒ</h1>
        </header>

        <div class="main-content">
            <div id="canvas-container">
                <canvas id="three-canvas"></canvas>
                <!-- UIç»„ä»¶å°†é€šè¿‡JavaScriptæ·»åŠ  -->
            </div>
        </div>
    </div>

    <!-- Three.js åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- å¼•å…¥é€šç”¨ç»„ä»¶è„šæœ¬ -->
    <script src="../../common/js/ui-components.js"></script>
    <script src="../../common/js/knowledge-modal.js"></script>
    
    <!-- å¼•å…¥çŸ¥è¯†ç‚¹æ•°æ® -->
    <script src="knowledge-data.js"></script>
    
    <script>
        // ============================================
        // ä½¿ç”¨ç»„ä»¶åº“åˆå§‹åŒ–UI
        // ============================================
        function initUI() {
            const container = document.getElementById('canvas-container');
            
            // 1. åˆ›å»ºè¿”å›ä¸»é¡µæŒ‰é’®
            const homeBtn = GeoUIComponents.createHomeButton('../../index.html');
            document.body.appendChild(homeBtn);
            
            // 2. åˆ›å»ºå¸®åŠ©æŒ‰é’®
            const helpBtn = GeoUIComponents.createHelpButton(() => {
                GeoKnowledgeModal.show();
            });
            document.body.appendChild(helpBtn);
            
            // 3. åˆ›å»ºä¿¡æ¯é¢æ¿
            const infoPanel = GeoUIComponents.createInfoPanel({
                id: 'info-panel',
                position: 'top-left'
            });
            const infoPanelContent = document.getElementById('info-panel-content');
            infoPanelContent.innerHTML = `
                <div class="season" id="current-season">å½“å‰ï¼šæ˜¥åˆ†</div>
                <div class="subsolar-point">ç›´å°„ç‚¹ï¼š<span id="subsolar-lat">èµ¤é“ (0Â°)</span></div>
                <div>æ—¥æœŸï¼š<span id="date-ref">3æœˆ21æ—¥</span></div>
                <div class="motion-info">
                    <div class="motion-item orbit-info">
                        <span class="motion-icon">ğŸ”„</span>
                        <span>å…¬è½¬ï¼šé€†æ—¶é’ˆï¼ˆä¿¯è§†åŒ—æï¼‰</span>
                    </div>
                    <div class="motion-item rotation-info">
                        <span class="motion-icon">ğŸŒ€</span>
                        <span>è‡ªè½¬ï¼šè‡ªè¥¿å‘ä¸œ</span>
                    </div>
                </div>
            `;
            container.appendChild(infoPanel);
            
            // 4. åˆ›å»ºå›¾ä¾‹é¢æ¿
            const legendPanel = GeoUIComponents.createLegendPanel(legendsData);
            container.appendChild(legendPanel);
            
            // 5. åˆ›å»ºæ§åˆ¶é¢æ¿
            const controlPanel = GeoUIComponents.createControlPanel({
                title: 'â–¶ åŠ¨ç”»æ§åˆ¶',
                sliders: [
                    {
                        id: 'orbit-slider',
                        label: 'å…¬è½¬',
                        min: 0,
                        max: 360,
                        value: 0,
                        onChange: (e) => {
                            updateOrbitPosition(parseFloat(e.target.value));
                            // å–æ¶ˆå­£èŠ‚æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
                            document.querySelectorAll('.bottom-btn-bar button').forEach(b => 
                                b.classList.remove('active')
                            );
                        }
                    }
                ],
                buttons: [
                    { 
                        id: 'pause-btn', 
                        label: 'æš‚åœ', 
                        onClick: function() {
                            isPaused = !isPaused;
                            this.textContent = isPaused ? 'æ’­æ”¾' : 'æš‚åœ';
                        }
                    },
                    { 
                        id: 'slow-btn', 
                        label: 'æ…¢', 
                        onClick: function() {
                            animationSpeed = 0.3;
                            isPaused = false;
                            document.getElementById('pause-btn').textContent = 'æš‚åœ';
                            GeoUIComponents.updateSpeedButtons(this);
                        }
                    },
                    { 
                        id: 'normal-btn', 
                        label: 'æ­£å¸¸', 
                        active: true,
                        onClick: function() {
                            animationSpeed = 1;
                            isPaused = false;
                            document.getElementById('pause-btn').textContent = 'æš‚åœ';
                            GeoUIComponents.updateSpeedButtons(this);
                        }
                    },
                    { 
                        id: 'fast-btn', 
                        label: 'å¿«', 
                        onClick: function() {
                            animationSpeed = 3;
                            isPaused = false;
                            document.getElementById('pause-btn').textContent = 'æš‚åœ';
                            GeoUIComponents.updateSpeedButtons(this);
                        }
                    }
                ]
            });
            container.appendChild(controlPanel);
            
            // 6. åˆ›å»ºè§†è§’è¯´æ˜é¢æ¿
            const viewInfoPanel = document.createElement('div');
            viewInfoPanel.className = 'view-info-panel';
            viewInfoPanel.innerHTML = `
                <h4>ğŸ‘ è§‚å¯Ÿè§†è§’</h4>
                <div class="view-item">
                    <span class="view-icon">ğŸŒŒ</span>
                    <span>åŒ—åŠçƒä¸Šç©ºæ–œè§†</span>
                </div>
                <div class="view-item">
                    <span class="view-icon">â¬†</span>
                    <span>ä¸Šæ–¹ä¸ºåŒ—ææ˜Ÿæ–¹å‘</span>
                </div>
                <div class="view-divider"></div>
                <div class="view-item motion">
                    <span class="view-icon">ğŸ”„</span>
                    <span>å…¬è½¬ï¼šé€†æ—¶é’ˆ</span>
                </div>
                <div class="view-item motion">
                    <span class="view-icon">ğŸŒ€</span>
                    <span>è‡ªè½¬ï¼šè‡ªè¥¿å‘ä¸œ</span>
                </div>
            `;
            container.appendChild(viewInfoPanel);
            
            // 7. åˆ›å»ºåº•éƒ¨å­£èŠ‚é€‰æ‹©æ 
            const seasonButtons = [
                { 
                    label: 'ğŸŒ¸ æ˜¥åˆ†', 
                    value: 'spring', 
                    className: 'season-btn spring',
                    active: true, 
                    onClick: function() { selectSeason('spring'); }
                },
                { 
                    label: 'â˜€ï¸ å¤è‡³', 
                    value: 'summer', 
                    className: 'season-btn summer',
                    onClick: function() { selectSeason('summer'); }
                },
                { 
                    label: 'ğŸ‚ ç§‹åˆ†', 
                    value: 'autumn', 
                    className: 'season-btn autumn',
                    onClick: function() { selectSeason('autumn'); }
                },
                { 
                    label: 'â„ï¸ å†¬è‡³', 
                    value: 'winter', 
                    className: 'season-btn winter',
                    onClick: function() { selectSeason('winter'); }
                }
            ];
            const bottomBar = GeoUIComponents.createBottomButtonBar(seasonButtons);
            container.appendChild(bottomBar);
            
            // 8. åˆ›å»ºçŸ¥è¯†ç‚¹å¼¹çª—
            const modal = GeoKnowledgeModal.createModal(obliquityKnowledgeData);
            document.body.appendChild(modal);
            
            // 9. åˆ›å»ºå·¥å…·æç¤º
            const tooltip = GeoUIComponents.createTooltip();
            document.body.appendChild(tooltip);
        }
        
        // ============================================
        // ä¸šåŠ¡é€»è¾‘å‡½æ•°ï¼ˆè¿™äº›æ˜¯é¡µé¢ç‰¹å®šçš„ï¼‰
        // ============================================
        
        // å…¨å±€å¸¸é‡
        const OBLIQUITY = 23.5;
        const OBLIQUITY_RAD = OBLIQUITY * Math.PI / 180;
        
        // åœºæ™¯å˜é‡
        let scene, camera, renderer;
        let earth, earthGroup, sun;
        let orbitAngle = 0;
        let animationSpeed = 1;
        let isPaused = false;
        
        // é€‰æ‹©å­£èŠ‚
        function selectSeason(season) {
            const data = seasonsData[season];
            updateOrbitPosition(data.angle);
        }
        
        // æ›´æ–°è½¨é“ä½ç½®
        function updateOrbitPosition(angle) {
            orbitAngle = angle;
            const theta = angle * Math.PI / 180;
            const radius = 15;
            
            if (earthGroup) {
                earthGroup.position.x = radius * Math.cos(theta);
                earthGroup.position.z = radius * Math.sin(theta);
            }
            
            updateInfoPanel(angle);
        }
        
        // æ›´æ–°ä¿¡æ¯é¢æ¿
        function updateInfoPanel(angle) {
            const subsolarLat = OBLIQUITY * Math.sin(angle * Math.PI / 180);
            
            let seasonName = '';
            let dateRef = '';
            
            if (angle >= 350 || angle < 10) {
                seasonName = 'æ˜¥åˆ†';
                dateRef = '3æœˆ21æ—¥å·¦å³';
            } else if (angle >= 10 && angle < 80) {
                seasonName = 'æ˜¥åˆ†â†’å¤è‡³';
                dateRef = '3æœˆ~6æœˆ';
            } else if (angle >= 80 && angle < 100) {
                seasonName = 'å¤è‡³';
                dateRef = '6æœˆ22æ—¥å·¦å³';
            } else if (angle >= 100 && angle < 170) {
                seasonName = 'å¤è‡³â†’ç§‹åˆ†';
                dateRef = '6æœˆ~9æœˆ';
            } else if (angle >= 170 && angle < 190) {
                seasonName = 'ç§‹åˆ†';
                dateRef = '9æœˆ23æ—¥å·¦å³';
            } else if (angle >= 190 && angle < 260) {
                seasonName = 'ç§‹åˆ†â†’å†¬è‡³';
                dateRef = '9æœˆ~12æœˆ';
            } else if (angle >= 260 && angle < 280) {
                seasonName = 'å†¬è‡³';
                dateRef = '12æœˆ22æ—¥å·¦å³';
            } else {
                seasonName = 'å†¬è‡³â†’æ˜¥åˆ†';
                dateRef = '12æœˆ~æ¬¡å¹´3æœˆ';
            }

            document.getElementById('current-season').textContent = `å½“å‰ä½ç½®ï¼š${seasonName}`;
            
            let latText = '';
            if (Math.abs(subsolarLat) < 0.5) {
                latText = 'èµ¤é“ (0Â°)';
            } else if (subsolarLat > 0) {
                latText = `åŒ—çº¬ ${subsolarLat.toFixed(1)}Â°`;
                if (Math.abs(subsolarLat - OBLIQUITY) < 1) {
                    latText = 'åŒ—å›å½’çº¿ (åŒ—çº¬23.5Â°)';
                }
            } else {
                latText = `å—çº¬ ${Math.abs(subsolarLat).toFixed(1)}Â°`;
                if (Math.abs(subsolarLat + OBLIQUITY) < 1) {
                    latText = 'å—å›å½’çº¿ (å—çº¬23.5Â°)';
                }
            }
            
            document.getElementById('subsolar-lat').textContent = latText;
            document.getElementById('date-ref').textContent = dateRef;
            document.getElementById('orbit-slider').value = angle;
        }
        
        // ============================================
        // Three.js åœºæ™¯åˆå§‹åŒ–ï¼ˆè¿™éƒ¨åˆ†ä¿æŒåŸæœ‰é€»è¾‘ï¼‰
        // ============================================
        function init() {
            // ... Three.js åˆå§‹åŒ–ä»£ç 
            // è¿™é‡Œåº”è¯¥åŒ…å«ä½ åŸæœ‰çš„ Three.js åœºæ™¯åˆ›å»ºä»£ç 
            console.log('Three.js scene initialized');
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (!isPaused) {
                // åŠ¨ç”»é€»è¾‘
                orbitAngle += 0.1 * animationSpeed;
                if (orbitAngle >= 360) orbitAngle -= 360;
                updateOrbitPosition(orbitAngle);
            }
            
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }
        
        // ============================================
        // å¯åŠ¨ç¨‹åº
        // ============================================
        window.addEventListener('DOMContentLoaded', () => {
            // æ£€æµ‹ç§»åŠ¨ç«¯
            GeoUIComponents.checkMobileDevice('mobile.html');
            
            // åˆå§‹åŒ–UIç»„ä»¶
            initUI();
            
            // åˆå§‹åŒ–Three.jsåœºæ™¯
            init();
            
            // å¼€å§‹åŠ¨ç”»
            animate();
        });
    </script>
</body>
</html>
